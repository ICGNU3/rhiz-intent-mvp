"use strict";(()=>{var e={};e.id=3958,e.ids=[3958],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},41808:e=>{e.exports=require("net")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},4074:e=>{e.exports=require("perf_hooks")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},2833:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>m,originalPathname:()=>h,requestAsyncStorage:()=>u,routeModule:()=>_,serverHooks:()=>y,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>g});var a={};r.r(a),r.d(a,{POST:()=>POST,dynamic:()=>d});var i=r(10884),n=r(16132),o=r(95798),s=r(37552),c=r(1345),p=r(24095);let d="force-dynamic";async function POST(e){try{let t=await (0,c.n5)();if(!t)return o.Z.json({error:"Unauthorized"},{status:401});let r=await e.json(),{analysis_type:a="health",goal_id:i}=r;try{let e;await (0,s.v8)(t);let r=await s.db.select({contact_id:s.pp.contactId,last_interaction_at:s.pp.lastInteractionAt,interactions_90d:s.pp.interactions90d,reciprocity_ratio:s.pp.reciprocityRatio,sentiment_avg:s.pp.sentimentAvg,decay_days:s.pp.decayDays,capacity_cost:s.pp.capacityCost,goal_alignment_score:s.pp.goalAlignmentScore}).from(s.pp).where((0,s.eq)(s.pp.userId,t)),n=r.map(e=>({contact_id:e.contact_id,last_interaction_at:e.last_interaction_at?.toISOString(),interactions_90d:e.interactions_90d,reciprocity_ratio:e.reciprocity_ratio/100,sentiment_avg:e.sentiment_avg/100,decay_days:e.decay_days,dunbar_layer:Math.floor(5*Math.random())+1,relationship_strength:Math.min(10,Math.max(1,10-e.decay_days/30)),capacity_cost:e.capacity_cost/100})),c=await s.db.select({contact_id:s.qU.id,interaction_type:s.qU.kind,timestamp:s.qU.occurredAt,context:s.qU.summary}).from(s.qU).where((0,s.eq)(s.qU.ownerId,t)).orderBy((0,s.C8)(s.qU.occurredAt)).limit(50),d=c.map(e=>({contact_id:e.contact_id,interaction_type:e.interaction_type,sentiment:2*Math.random()-1,timestamp:e.timestamp.toISOString(),context:e.context||void 0})),_=n.filter(e=>e.interactions_90d>0).length,u=n.reduce((e,t)=>e+t.capacity_cost,0)/n.length,l={userId:t,signals:n,recent_interactions:d,current_workload:{active_conversations:_,pending_outreach:0,capacity_utilization:u}};switch(a){case"capacity":e=await (0,p.W1)(l);break;case"reactivation":e=await (0,p.O$)({...l,dormant_threshold_days:90,target_layer:3});break;default:e=await (0,p.vR)(l)}return await s.db.insert(s.M0).values({userId:t,goalId:i||null,agent:"sensemaker",action:e.action,payload:e}),o.Z.json(e)}catch(r){console.error("Database query failed:",r);let e=await (0,p.vR)({userId:t,signals:[{contact_id:"1",last_interaction_at:"2024-01-15T00:00:00Z",interactions_90d:12,reciprocity_ratio:.8,sentiment_avg:.7,decay_days:5,dunbar_layer:2,relationship_strength:8,capacity_cost:.6}],recent_interactions:[],current_workload:{active_conversations:5,pending_outreach:2,capacity_utilization:.7}});return o.Z.json(e)}}catch(e){return console.error("Agent sense error:",e),o.Z.json({error:"Internal server error"},{status:500})}}let _=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/agents/sense/route",pathname:"/api/agents/sense",filename:"route",bundlePath:"app/api/agents/sense/route"},resolvedPagePath:"/Users/israelwilson/Developer/rhiz-intent-mvp/apps/web/app/api/agents/sense/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:u,staticGenerationAsyncStorage:l,serverHooks:y,headerHooks:m,staticGenerationBailout:g}=_,h="/api/agents/sense/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[729,5798,9155,1811,7552,7945],()=>__webpack_exec__(2833));module.exports=r})();