"use strict";(()=>{var e={};e.id=7541,e.ids=[7541],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57165:(e,t,n)=>{n.r(t),n.d(t,{headerHooks:()=>p,originalPathname:()=>m,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>g});var r={};n.r(r),n.d(r,{GET:()=>GET,dynamic:()=>l});var i=n(10884),o=n(16132),s=n(95798),a=n(37552),c=n(14333);let l="force-dynamic";async function GET(e){try{let{searchParams:t}=new URL(e.url),n=t.get("userId")||"default-user",r=parseInt(t.get("depth")||"2"),i=parseInt(t.get("minStrength")||"3");c.k.info("Analyzing connection flow",{userId:n,depth:r,minStrength:i});let[o,l]=await Promise.all([a.db.select({id:a.lB.id,name:a.lB.fullName,email:a.lB.primaryEmail,location:a.lB.location,createdAt:a.lB.createdAt,updatedAt:a.lB.updatedAt}).from(a.lB).where((0,a.eq)(a.lB.ownerId,n)).limit(500),a.db.select({id:a.i$.id,personId:a.i$.fromId,relatedPersonId:a.i$.toId,relationshipType:a.i$.type,strength:a.i$.strength,metadata:a.i$.metadata,createdAt:a.i$.createdAt}).from(a.i$).where((0,a.eq)(a.i$.ownerId,n)).limit(1e3)]),u=o.map(e=>({id:e.id,name:e.name,type:"person",size:5,connections:0,influence:calculateInfluence(e,l),cluster:detectCluster(e),metadata:{email:e.email||void 0,location:e.location||void 0,strength:5}})),d=[],f={};l.forEach(e=>{e.strength>=i&&(f[e.personId]=(f[e.personId]||0)+1,f[e.relatedPersonId]=(f[e.relatedPersonId]||0)+1,d.push({source:e.personId,target:e.relatedPersonId,value:e.strength,type:getEdgeType(e.strength),direction:"bidirectional",metadata:{lastInteraction:e.createdAt}}))}),u.forEach(e=>{e.connections=f[e.id]||0});let h=detectCommunities(u,d),p=calculateFlowMetrics(u,d),g=detectNetworkPatterns(u,d,p),m=findBridgeNodes(u,d,h),y=findInfluencers(u,d),w=generateFlowInsights(u,d,h,p,g),k=applyForceLayout(u,d);return s.Z.json({nodes:k.nodes,edges:d,clusters:h,metrics:{...p,bridgeNodes:m,influencers:y},patterns:g,insights:w,timestamp:new Date().toISOString()})}catch(e){return c.k.error("Failed to analyze connection flow",e),s.Z.json({error:"Failed to analyze connection flow"},{status:500})}}function calculateInfluence(e,t){let n=t.filter(t=>t.personId===e.id||t.relatedPersonId===e.id).length,r=e.updatedAt?Math.max(0,10-(Date.now()-new Date(e.updatedAt).getTime())/2592e6):5;return(2*n+5+r)/4}function detectCluster(e){if(e.location)return e.location;if(e.email){let t=e.email.split("@")[1];if(t)return t}return"general"}function getEdgeType(e){return e>=8?"strong":e>=5?"moderate":e>=3?"weak":"potential"}function detectCommunities(e,t){let n=new Map;return e.forEach(e=>{let t=e.cluster||"general";n.has(t)||n.set(t,new Set),n.get(t).add(e.id)}),Array.from(n.entries()).map(([n,r],i)=>{let o=e.filter(e=>r.has(e.id)),s=t.filter(e=>r.has(e.source)&&r.has(e.target));return{id:`cluster-${i}`,name:n,type:detectClusterType(n),size:r.size,density:calculateDensity(o,s),centralNodes:findCentralNodes(o,t),color:getClusterColor(i)}})}function detectClusterType(e){return e.includes("Inc")||e.includes("LLC")||e.includes("Corp")?"company":e.includes("University")||e.includes("College")?"school":e.includes(",")?"location":"interest"}function calculateDensity(e,t){if(e.length<2)return 0;let n=e.length*(e.length-1)/2;return t.length/n}function findCentralNodes(e,t){return e.sort((e,t)=>t.influence-e.influence).slice(0,3).map(e=>e.id)}function getClusterColor(e){let t=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"];return t[e%t.length]}function calculateFlowMetrics(e,t){let n=e.length,r=t.length,i=n*(n-1)/2,o=calculateClusteringCoefficient(e,t),s=calculateCentralityScore(e,t);return{totalNodes:n,totalEdges:r,averageDegree:n>0?2*r/n:0,clusteringCoefficient:o,networkDensity:i>0?r/i:0,centralityScore:s,bridgeNodes:[],influencers:[]}}function calculateClusteringCoefficient(e,t){let n=0,r=0;return e.forEach(e=>{let i=t.filter(t=>t.source===e.id||t.target===e.id).map(t=>t.source===e.id?t.target:t.source);if(i.length>=2){let e=i.length*(i.length-1)/2,o=t.filter(e=>i.includes(e.source)&&i.includes(e.target)).length;n+=o/e,r++}}),r>0?n/r:0}function calculateCentralityScore(e,t){let n=e.reduce((e,t)=>e+t.influence,0);return e.length>0?n/e.length:0}function detectNetworkPatterns(e,t,n){let r=[],i=Math.max(...e.map(e=>e.connections)),o=n.averageDegree;return i>3*o&&r.push({type:"hub_and_spoke",strength:(i-o)/o,description:"Your network has central hubs with many connections",recommendations:["Leverage hub connections for introductions","Build direct relationships to reduce dependency on hubs"]}),n.clusteringCoefficient>.3&&n.averageDegree>4&&r.push({type:"small_world",strength:n.clusteringCoefficient,description:"Your network exhibits small-world properties with tight clusters",recommendations:["Use cluster bridges for rapid information spread","Identify and strengthen weak ties between clusters"]}),n.networkDensity<.3&&n.clusteringCoefficient>.4&&r.push({type:"community",strength:n.clusteringCoefficient/(1-n.networkDensity),description:"Your network has distinct community structures",recommendations:["Foster cross-community connections","Identify community leaders for targeted engagement"]}),r}function findBridgeNodes(e,t,n){let r=new Set;return t.forEach(t=>{let n=e.find(e=>e.id===t.source)?.cluster,i=e.find(e=>e.id===t.target)?.cluster;n!==i&&(r.add(t.source),r.add(t.target))}),Array.from(r)}function findInfluencers(e,t){return e.sort((e,t)=>t.influence-e.influence).slice(0,5).map(e=>e.id)}function generateFlowInsights(e,t,n,r,i){let o=[];return e.length>100?o.push(`Your network of ${e.length} connections is large and diverse. Focus on quality over quantity.`):e.length<30&&o.push(`With ${e.length} connections, you have room to expand. Target strategic connections in your field.`),r.networkDensity>.5?o.push("Your network is highly interconnected. This creates strong trust and information flow."):r.networkDensity<.1&&o.push("Your network has low density. Consider introducing connections to each other."),r.clusteringCoefficient>.5&&o.push("High clustering indicates tight-knit groups. Leverage these for deep collaboration."),i.forEach(e=>{"hub_and_spoke"===e.type&&e.strength>2&&o.push("You have super-connectors in your network. They can accelerate introductions."),"community"===e.type&&e.strength>1.5&&o.push("Strong community structures detected. Bridge these communities for unique opportunities.")}),n.length>5&&o.push(`Your network spans ${n.length} distinct clusters. This diversity is valuable for innovation.`),o}function applyForceLayout(e,t){e.forEach(e=>{e.x=400+(Math.random()-.5)*640,e.y=300+(Math.random()-.5)*480});for(let n=0;n<50;n++)e.forEach((n,r)=>{let i=0,o=0;e.forEach((e,t)=>{if(r!==t){let t=n.x-e.x,r=n.y-e.y,s=Math.sqrt(t*t+r*r);if(s>0&&s<100){let e=100/(s*s);i+=t/s*e,o+=r/s*e}}}),t.forEach(t=>{let r;if(t.source===n.id?r=e.find(e=>e.id===t.target):t.target===n.id&&(r=e.find(e=>e.id===t.source)),r){let e=r.x-n.x,s=r.y-n.y,a=Math.sqrt(e*e+s*s);if(a>0){let n=.01*a*t.value;i+=e/a*n,o+=s/a*n}}}),n.x+=.1*i,n.y+=.1*o,n.x=Math.max(50,Math.min(750,n.x)),n.y=Math.max(50,Math.min(550,n.y))});return{nodes:e,edges:t}}let u=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/insights/connection-flow/route",pathname:"/api/insights/connection-flow",filename:"route",bundlePath:"app/api/insights/connection-flow/route"},resolvedPagePath:"/Users/israelwilson/Developer/rhiz-intent-mvp/apps/web/app/api/insights/connection-flow/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:f,serverHooks:h,headerHooks:p,staticGenerationBailout:g}=u,m="/api/insights/connection-flow/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),n=t.X(0,[729,5798,9155,7552,4333],()=>__webpack_exec__(57165));module.exports=n})();