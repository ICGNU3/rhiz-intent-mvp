"use strict";(()=>{var e={};e.id=1567,e.ids=[1567],e.modules={524:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},59796:e=>{e.exports=require("zlib")},39009:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>m,originalPathname:()=>h,requestAsyncStorage:()=>u,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>w});var r={};a.r(r),a.d(r,{GET:()=>GET});var o=a(10884),s=a(16132),n=a(95798),c=a(54556);let i=process.env.SUPABASE_SERVICE_ROLE_KEY,d=(0,c.eI)("https://whdwzrnyubpexjtjzcwh.supabase.co",i);async function GET(e){try{let{searchParams:t}=new URL(e.url),a=t.get("workspaceId"),r=t.get("period")||"30";if(!a)return n.Z.json({error:"Workspace ID is required"},{status:400});let o="demo"===a?"550e8400-e29b-41d4-a716-446655440001":a,{data:s,error:c}=await d.from("event_log").select("created_at, event").eq("workspace_id",o).eq("event","person_enriched").gte("created_at",new Date(Date.now()-864e5*parseInt(r)).toISOString()),{data:i,error:p}=await d.from("suggestion").select("created_at, state").eq("workspace_id",o).eq("kind","introduction").gte("created_at",new Date(Date.now()-864e5*parseInt(r)).toISOString()),{data:u,error:l}=await d.from("goal").select("status").eq("workspace_id",o),{data:g,error:m}=await d.from("person").select("id").eq("workspace_id",o);if(c||p||l||m)return console.error("Database errors:",{networkError:c,suggestionsError:p,goalsError:l,peopleError:m}),n.Z.json({networkGrowth:[{date:"2024-01-01",count:5},{date:"2024-01-02",count:3},{date:"2024-01-03",count:7}],introductionsData:[{date:"2024-01-01",total:2,accepted:1,completed:0},{date:"2024-01-02",total:3,accepted:2,completed:1},{date:"2024-01-03",total:1,accepted:1,completed:0}],goalProgress:[{status:"active",count:3},{status:"completed",count:1}],dormantRelationships:[{date:"2024-01-01",count:2},{date:"2024-01-02",count:1},{date:"2024-01-03",count:3}],metrics:{totalContacts:25,totalSuggestions:6,acceptedSuggestions:4,activeGoals:3,acceptanceRate:67}});let w=s?.map(e=>({date:new Date(e.created_at).toISOString().split("T")[0],count:1})).reduce((e,t)=>{let a=e.find(e=>e.date===t.date);return a?a.count+=1:e.push(t),e},[])||[],h=i?.map(e=>({date:new Date(e.created_at).toISOString().split("T")[0],total:1,accepted:"accepted"===e.state?1:0,completed:"completed"===e.state?1:0})).reduce((e,t)=>{let a=e.find(e=>e.date===t.date);return a?(a.total+=1,a.accepted+=t.accepted,a.completed+=t.completed):e.push(t),e},[])||[],_=u?.reduce((e,t)=>{let a=e.find(e=>e.status===t.status);return a?a.count+=1:e.push({status:t.status,count:1}),e},[])||[],f=i?.filter(e=>"accepted"===e.state).length||0,v=i?.length||0,q=u?.filter(e=>"active"===e.status).length||0,k={networkGrowth:w,introductionsData:h,goalProgress:_,dormantRelationships:[],metrics:{totalContacts:g?.length||0,totalSuggestions:v,acceptedSuggestions:f,activeGoals:q,acceptanceRate:v>0?Math.round(f/v*100):0}};return n.Z.json(k)}catch(e){return console.error("Error fetching analytics:",e),n.Z.json({error:"Failed to fetch analytics"},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"/Users/israelwilson/Developer/rhiz-intent-mvp/apps/web/app/api/analytics/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:l,serverHooks:g,headerHooks:m,staticGenerationBailout:w}=p,h="/api/analytics/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[729,5798,4556],()=>__webpack_exec__(39009));module.exports=a})();