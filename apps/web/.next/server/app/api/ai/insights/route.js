"use strict";(()=>{var e={};e.id=1631,e.ids=[1631],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},47910:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>w,requestAsyncStorage:()=>u,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>g});var i={};r.r(i),r.d(i,{POST:()=>POST});var o=r(10884),a=r(16132),s=r(95798),n=r(37552),c=r(1345),d=r(37058);async function POST(e){try{let t=await (0,c.n5)();if(!t)return s.Z.json({error:"Unauthorized"},{status:401});let r=await e.json(),{workspaceId:i,type:o="general"}=r;if(!i)return s.Z.json({error:"Workspace ID is required"},{status:400});let a=[];try{switch(o){case"network_gaps":{let[e,t,r]=await Promise.all([n.db.select().from(n.hS).where((0,n.xD)((0,n.eq)(n.hS.workspaceId,i),(0,n.eq)(n.hS.status,"active"))).limit(10),n.db.select().from(n.lB).where((0,n.eq)(n.lB.workspaceId,i)).limit(100),n.db.select().from(n.i$).where((0,n.eq)(n.i$.workspaceId,i)).limit(200)]),o={nodes:t.map(e=>({id:e.id,name:e.fullName,email:e.primaryEmail})),edges:r.map(e=>({from:e.fromId,to:e.toId,type:e.type,strength:e.strength}))};a=await (0,d.gc)(o,e);break}case"dormant_ties":{let e=await n.db.select({id:n.qU.id,occurredAt:n.qU.occurredAt}).from(n.qU).where((0,n.eq)(n.qU.workspaceId,i)).orderBy((0,n.C8)(n.qU.occurredAt)).limit(20);a=e.map(e=>({type:"dormant_tie",title:"Reconnection Opportunity",description:"Haven't connected recently - consider reaching out",encounterId:e.id,score:75,metadata:{lastContact:e.occurredAt,daysSince:Math.floor((Date.now()-new Date(e.occurredAt||Date.now()).getTime())/864e5)}}));break}case"introduction_opportunities":{let[e,t]=await Promise.all([n.db.select().from(n.lB).where((0,n.eq)(n.lB.workspaceId,i)).limit(50),n.db.select().from(n.QS).where((0,n.xD)((0,n.eq)(n.QS.workspaceId,i),n.i6`claim.key IN ('expertise', 'interests', 'goals')`)).limit(200)]),r={};t.forEach(e=>{r[e.subjectId]||(r[e.subjectId]=[]),r[e.subjectId].push(e)});let o=[];for(let t=0;t<e.length;t++)for(let i=t+1;i<e.length;i++){let a=r[e[t].id]||[],s=r[e[i].id]||[],n=a.filter(e=>s.some(t=>e.key===t.key&&e.value.toLowerCase().includes(t.value.toLowerCase())));n.length>0&&o.push({type:"introduction",title:`Connect ${e[t].fullName} with ${e[i].fullName}`,description:`Shared interests in: ${n.map(e=>e.value).join(", ")}`,score:Math.min(95,60+10*n.length),metadata:{person1Id:e[t].id,person2Id:e[i].id,commonInterests:n.map(e=>e.value)}})}a=o.slice(0,10);break}default:{let[e,t]=await Promise.all([n.db.select().from(n.hS).where((0,n.xD)((0,n.eq)(n.hS.workspaceId,i),(0,n.eq)(n.hS.status,"active"))).limit(5),n.db.select().from(n.qU).where((0,n.eq)(n.qU.workspaceId,i)).orderBy((0,n.C8)(n.qU.occurredAt)).limit(10)]);a=[...e.map(e=>({type:"goal_reminder",title:`Active Goal: ${e.title}`,description:e.details||"Consider next steps for this goal",goalId:e.id,score:80})),...t.slice(0,3).map(e=>({type:"follow_up",title:"Follow-up Opportunity",description:e.summary||"Consider following up on recent conversation",encounterId:e.id,score:70}))]}}let e=await (0,d.wA)(a,{hasActiveGoals:!0,recentActivity:"high",networkSize:"medium"});return s.Z.json({success:!0,insights:e,metadata:{type:o,count:e.length,generated:new Date().toISOString()}})}catch(e){return console.log("Database query failed, returning mock insights:",e),s.Z.json({success:!0,insights:[{type:"network_gap",title:"Expand Your Engineering Network",description:"Your network lacks senior engineers. Consider attending tech meetups or reaching out to engineering leaders.",score:85,aiGenerated:!0},{type:"introduction",title:"Strategic Introduction Opportunity",description:"Based on your goals, connecting with investors in the fintech space could accelerate your fundraising.",score:92,aiGenerated:!0},{type:"dormant_tie",title:"Reactivate Valuable Connection",description:"You haven't connected with your previous advisors in 60+ days. They could provide valuable guidance.",score:78,aiGenerated:!0}],metadata:{type:o,count:3,generated:new Date().toISOString(),demo:!0}})}}catch(e){return console.error("AI insights error:",e),s.Z.json({error:"Failed to generate insights"},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/ai/insights/route",pathname:"/api/ai/insights",filename:"route",bundlePath:"app/api/ai/insights/route"},resolvedPagePath:"/Users/israelwilson/Developer/rhiz-intent-mvp/apps/web/app/api/ai/insights/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:u,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:h,staticGenerationBailout:g}=l,w="/api/ai/insights/route"},1345:(e,t,r)=>{async function getUserId(){return"alice-user-id"}r.d(t,{n5:()=>getUserId})}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[729,5798,9155,8332,4589,7552,4333,7058],()=>__webpack_exec__(47910));module.exports=r})();