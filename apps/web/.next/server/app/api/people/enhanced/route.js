"use strict";(()=>{var e={};e.id=3363,e.ids=[3363],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},51526:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>h,originalPathname:()=>f,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>y});var n={};r.r(n),r.d(n,{GET:()=>GET});var a=r(10884),i=r(16132),o=r(95798),l=r(37552),c=r(1345);let s=[{layer:1,name:"intimate",maxSize:5,description:"Intimate bonds - closest relationships",interactionFrequency:"daily"},{layer:2,name:"close",maxSize:15,description:"Close friends and family",interactionFrequency:"weekly"},{layer:3,name:"meaningful",maxSize:50,description:"Meaningful connections",interactionFrequency:"monthly"},{layer:4,name:"stable",maxSize:150,description:"Stable social network",interactionFrequency:"quarterly"},{layer:5,name:"extended",maxSize:1500,description:"Extended network",interactionFrequency:"annual"}];function calculateRelationshipMetrics(e,t,r=5,n=5,a=5){let i=Math.min(1,e/12),o=Math.round((.3*Math.max(0,1-t/365)+.4*i+.3*(r/10))*10),l=determineDunbarLayer(o,e/12);return{strength:Math.max(1,Math.min(10,o)),dunbarLayer:l,lastInteraction:new Date(Date.now()-864e5*t),interactionFrequency:e/12,emotionalConnection:r,contextualRelevance:n,mutualEngagement:a}}function determineDunbarLayer(e,t){return e>=8&&t>=8?s[0]:e>=7&&t>=2?s[1]:e>=5&&t>=.5?s[2]:e>=3&&t>=.1?s[3]:s[4]}function findRhizomaticConnections(e,t){let r=[];return t.forEach(t=>{if(e.id===t.id)return;e.location===t.location&&r.push({type:"temporal",strength:.6,description:`Both in ${e.location}`,sharedAttributes:["location"]});let n=findSharedAttributes(e.claims?.filter(e=>"interests"===e.key)||[],t.claims?.filter(e=>"interests"===e.key)||[]);n.length>0&&r.push({type:"contextual",strength:.7,description:`Shared interests: ${n.join(", ")}`,sharedAttributes:n});let a=findComplementaryAttributes(e.claims?.filter(e=>"expertise"===e.key)||[],t.claims?.filter(e=>"expertise"===e.key)||[]);a.length>0&&r.push({type:"intellectual",strength:.8,description:`Complementary expertise: ${e.fullName} (${a[0]}) + ${t.fullName} (${a[1]})`,sharedAttributes:a})}),r.sort((e,t)=>t.strength-e.strength)}function findSharedAttributes(e,t){let r=e.flatMap(e=>e.value.split(",").map(e=>e.trim().toLowerCase())),n=t.flatMap(e=>e.value.split(",").map(e=>e.trim().toLowerCase()));return r.filter(e=>n.includes(e))}function findComplementaryAttributes(e,t){return e.length>0&&t.length>0?[e[0].value,t[0].value]:[]}function generateCyberneticFeedback(e,t=[]){let r=Math.floor((Date.now()-e.lastInteraction.getTime())/864e5),n=[e.strength/10,Math.max(0,1-r/30),e.interactionFrequency/2,e.emotionalConnection/10,e.mutualEngagement/10],a=Math.round(n.reduce((e,t)=>e+t,0)/n.length*10),i=getExpectedFrequency(e.dunbarLayer),o=r>i,l=generateSuggestions(e,r,o),c=generateAdaptiveRecommendations(e,t);return{relationshipHealth:a,maintenanceNeeded:o,suggestedActions:l,energyLevel:a>=7?"high":a>=4?"medium":"low",adaptiveRecommendations:c}}function getExpectedFrequency(e){switch(e.interactionFrequency){case"daily":return 1;case"weekly":return 7;case"monthly":default:return 30;case"quarterly":return 90;case"annual":return 365}}function generateSuggestions(e,t,r){let n=[];return r&&n.push(`Reach out to maintain your ${e.dunbarLayer.name} connection`),e.emotionalConnection<5&&n.push("Consider a more personal conversation to deepen the relationship"),e.contextualRelevance<5&&n.push("Find current shared interests or projects to discuss"),t>90&&n.push("Share a life update or ask about recent changes"),n}function generateAdaptiveRecommendations(e,t){let r=[];switch(0===t.length?r.push("Start with a light, non-committal message"):r.push("Continue the conversation thread from your last interaction"),e.dunbarLayer.name){case"intimate":r.push("Share something personal or ask for advice");break;case"close":r.push("Check in on their current projects or challenges");break;case"meaningful":r.push("Suggest a coffee/call to catch up properly");break;case"stable":r.push("Send an article or resource they might find interesting");break;case"extended":r.push("Congratulate on recent achievements or life updates")}return r}async function GET(e){try{let t=await (0,c.n5)();if(!t)return o.Z.json({error:"Unauthorized"},{status:401});let r=e.nextUrl.searchParams,n=r.get("workspaceId")||"550e8400-e29b-41d4-a716-446655440001",a=parseInt(r.get("limit")||"50"),i=parseInt(r.get("offset")||"0"),u=r.get("layer"),d="true"===r.get("rhizomatic"),p="true"===r.get("feedback");try{await (0,l.v8)(t);let e=await l.db.select({id:l.lB.id,fullName:l.lB.fullName,primaryEmail:l.lB.primaryEmail,location:l.lB.location,createdAt:l.lB.createdAt,updatedAt:l.lB.updatedAt}).from(l.lB).where((0,l.xD)((0,l.eq)(l.lB.workspaceId,n),(0,l.eq)(l.lB.ownerId,t))).limit(a).offset(i).orderBy((0,l.C8)(l.lB.updatedAt)),r=await Promise.all(e.map(async t=>{let r=await l.db.select().from(l.QS).where((0,l.xD)((0,l.eq)(l.QS.subjectType,"person"),(0,l.eq)(l.QS.subjectId,t.id),(0,l.eq)(l.QS.workspaceId,n))).orderBy((0,l.C8)(l.QS.confidence)),a=await l.db.select().from(l.oR).where((0,l.eq)(l.oR.personId,t.id)),i=await l.db.select({encounter:l.qU}).from(l.oR).innerJoin(l.qU,(0,l.eq)(l.oR.encounterId,l.qU.id)).where((0,l.eq)(l.oR.personId,t.id)).orderBy((0,l.C8)(l.qU.createdAt)).limit(1),o=a.length,c=i[0]?Math.floor((Date.now()-new Date(i[0].encounter.createdAt).getTime())/864e5):365,s=calculateRelationshipMetrics(o,c,7,6,6),u={id:t.id,fullName:t.fullName,primaryEmail:t.primaryEmail,location:t.location,lastEncounter:i[0]?.encounter.createdAt||t.createdAt,relationshipStrength:s.strength,dunbarLayer:s.dunbarLayer,relationshipMetrics:s,claims:r.map(e=>({key:e.key,value:e.value,confidence:e.confidence/100}))},m=[];d&&(m=findRhizomaticConnections(u,e));let h=null;return p&&(h=generateCyberneticFeedback(s,[])),{...u,...d&&{rhizomaticConnections:m},...p&&{cyberneticFeedback:h}}})),c=r;if(u){let e=parseInt(u);c=r.filter(t=>t.dunbarLayer.layer===e)}let m=s.map(e=>({layer:e.layer,name:e.name,count:r.filter(t=>t.dunbarLayer.layer===e.layer).length,maxSize:e.maxSize,description:e.description}));return o.Z.json({people:c,layerStats:m,total:r.length})}catch(n){console.error("Database query failed, using enhanced mock data:",n);let e=[{id:"1",fullName:"Sarah Chen",primaryEmail:"sarah.chen@techcorp.com",location:"San Francisco, CA",lastEncounter:"2024-01-15",relationshipStrength:8,dunbarLayer:s[1],relationshipMetrics:calculateRelationshipMetrics(12,5,8,7,8),claims:[{key:"role",value:"Senior Software Engineer",confidence:.95},{key:"company",value:"TechCorp",confidence:.98},{key:"expertise",value:"AI/ML, Full Stack Development",confidence:.9},{key:"interests",value:"Startups, Product Development",confidence:.85}],...d&&{rhizomaticConnections:[{type:"intellectual",strength:.8,description:"Shared interest in AI/ML and startups",sharedAttributes:["AI/ML","Startups"]}]},...p&&{cyberneticFeedback:generateCyberneticFeedback(calculateRelationshipMetrics(12,5,8,7,8),[])}},{id:"2",fullName:"Mike Rodriguez",primaryEmail:"mike.rodriguez@startupxyz.com",location:"Austin, TX",lastEncounter:"2024-01-10",relationshipStrength:7,dunbarLayer:s[2],relationshipMetrics:calculateRelationshipMetrics(8,10,7,6,7),claims:[{key:"role",value:"CTO",confidence:.98},{key:"company",value:"StartupXYZ",confidence:.95},{key:"expertise",value:"SaaS, Scaling, Team Building",confidence:.92},{key:"interests",value:"SaaS, Growth, Leadership",confidence:.88}]},{id:"3",fullName:"David Kim",primaryEmail:"david.kim@venturecapital.com",location:"New York, NY",lastEncounter:"2024-01-05",relationshipStrength:6,dunbarLayer:s[3],relationshipMetrics:calculateRelationshipMetrics(4,15,6,8,5),claims:[{key:"role",value:"Partner",confidence:.98},{key:"company",value:"Venture Capital",confidence:.95},{key:"expertise",value:"Fintech, Growth, Investment",confidence:.9},{key:"interests",value:"Fintech, Investment, Startups",confidence:.85}]}],t=e.map(t=>{let r={...t};return d&&(r.rhizomaticConnections=findRhizomaticConnections(t,e)),p&&(r.cyberneticFeedback=generateCyberneticFeedback(t.relationshipMetrics,[])),r}),r=s.map(t=>({layer:t.layer,name:t.name,count:e.filter(e=>e.dunbarLayer.layer===t.layer).length,maxSize:t.maxSize,description:t.description}));return o.Z.json({people:t,layerStats:r,total:e.length})}}catch(e){return console.error("Enhanced People API error:",e),o.Z.json({error:"Internal server error"},{status:500})}}let u=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/people/enhanced/route",pathname:"/api/people/enhanced",filename:"route",bundlePath:"app/api/people/enhanced/route"},resolvedPagePath:"/Users/israelwilson/Developer/rhiz-intent-mvp/apps/web/app/api/people/enhanced/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:m,headerHooks:h,staticGenerationBailout:y}=u,f="/api/people/enhanced/route"},1345:(e,t,r)=>{async function getUserId(){return"alice-user-id"}r.d(t,{n5:()=>getUserId})}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[729,5798,9155,7552],()=>__webpack_exec__(51526));module.exports=r})();