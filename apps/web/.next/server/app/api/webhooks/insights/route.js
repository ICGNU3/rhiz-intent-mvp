"use strict";(()=>{var e={};e.id=5531,e.ids=[5531],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57147:e=>{e.exports=require("fs")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},4074:e=>{e.exports=require("perf_hooks")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},74282:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>g,originalPathname:()=>h,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>c,staticGenerationBailout:()=>p});var s={};t.r(s),t.d(s,{POST:()=>POST});var o=t(10884),n=t(16132),i=t(95798),a=t(37552);async function POST(e){try{let r=await e.json(),{workspaceId:t,userId:s,personId:o,action:n}=r;if(!t||!s||!o||!n)return i.Z.json({error:"Missing required fields"},{status:400});switch(await (0,a.v8)(s),n){case"get.insights":return await getPersonInsights(t,s,o);case"get.suggestions":return await getIntroductionSuggestions(t,s,o);default:return i.Z.json({error:"Unsupported action"},{status:400})}}catch(e){return console.error("Insights webhook error:",e),i.Z.json({error:"Internal server error"},{status:500})}}async function getPersonInsights(e,r,t){try{let s=await a.db.select().from(a.lB).where((0,a.xD)((0,a.eq)(a.lB.id,t),(0,a.eq)(a.lB.workspaceId,e),(0,a.eq)(a.lB.ownerId,r))).limit(1);if(0===s.length)return i.Z.json({error:"Person not found"},{status:404});let o=s[0],n=await a.db.select().from(a.QS).where((0,a.xD)((0,a.eq)(a.QS.subjectType,"person"),(0,a.eq)(a.QS.subjectId,t),(0,a.eq)(a.QS.workspaceId,e))).orderBy((0,a.C8)(a.QS.confidence)),u=await a.db.select().from(a.i$).where((0,a.xD)((0,a.eq)(a.i$.workspaceId,e),(0,a.eq)(a.i$.ownerId,r),(0,a.eq)(a.i$.fromId,t))),l=u.length>0?u.reduce((e,r)=>e+r.strength,0)/u.length:0,c=await a.db.select({personId:a.lB.id,fullName:a.lB.fullName,strength:a.i$.strength,type:a.i$.type}).from(a.i$).innerJoin(a.lB,(0,a.eq)(a.i$.toId,a.lB.id)).where((0,a.xD)((0,a.eq)(a.i$.workspaceId,e),(0,a.eq)(a.i$.ownerId,r),(0,a.eq)(a.i$.fromId,t))).orderBy((0,a.C8)(a.i$.strength)).limit(5);return i.Z.json({success:!0,insights:{person:{id:o.id,fullName:o.fullName,email:o.primaryEmail,location:o.location},claims:n.map(e=>({key:e.key,value:e.value,confidence:e.confidence/100,source:e.source})),relationships:{totalConnections:u.length,averageStrength:l,topConnections:c},lastUpdated:o.updatedAt}})}catch(e){return console.error("Get insights error:",e),i.Z.json({error:"Failed to get insights"},{status:500})}}async function getIntroductionSuggestions(e,r,t){try{return i.Z.json({success:!0,suggestions:[{id:"suggestion-1",targetPerson:{id:"target-1",fullName:"Jane Smith",company:"TechCorp",role:"CTO"},score:.85,reason:"Both work in AI/ML and have mutual connections",strength:8},{id:"suggestion-2",targetPerson:{id:"target-2",fullName:"Mike Johnson",company:"StartupXYZ",role:"Founder"},score:.72,reason:"Shared interest in SaaS and growth",strength:6}]})}catch(e){return console.error("Get suggestions error:",e),i.Z.json({error:"Failed to get suggestions"},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/webhooks/insights/route",pathname:"/api/webhooks/insights",filename:"route",bundlePath:"app/api/webhooks/insights/route"},resolvedPagePath:"/Users/israelwilson/Developer/rhiz-intent-mvp/apps/web/app/api/webhooks/insights/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:c,serverHooks:d,headerHooks:g,staticGenerationBailout:p}=u,h="/api/webhooks/insights/route"}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[729,5798,9155,7552],()=>__webpack_exec__(74282));module.exports=t})();