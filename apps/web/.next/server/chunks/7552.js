"use strict";exports.id=7552,exports.ids=[7552],exports.modules={37552:(e,t,r)=>{r.d(t,{xD:()=>n.xD,QS:()=>z,HM:()=>W,db:()=>eR,C8:()=>i.C,i$:()=>L,qU:()=>v,eq:()=>n.eq,hS:()=>j,t6:()=>h,lB:()=>g,v8:()=>setUserContext,i6:()=>s.i6,Jz:()=>B});var o={};r.r(o),r.d(o,{claim:()=>z,collectiveOpportunity:()=>W,consent:()=>V,conversation:()=>q,crmContactSync:()=>R,crossWorkspaceOverlap:()=>D,decryptOAuthToken:()=>decryptOAuthToken,decryptPhone:()=>decryptPhone,edge:()=>L,encounter:()=>v,encryptOAuthToken:()=>encryptOAuthToken,encryptPhone:()=>encryptPhone,eventLog:()=>b,goal:()=>j,graphInsight:()=>M,graphMetrics:()=>J,growthEvent:()=>P,insertCollectiveOpportunitySchema:()=>eA,insertConversationSchema:()=>ez,insertCrmContactSyncSchema:()=>es,insertCrossWorkspaceOverlapSchema:()=>eK,insertEdgeSchema:()=>ew,insertGoalSchema:()=>ee,insertGraphInsightSchema:()=>eN,insertGraphMetricsSchema:()=>ex,insertGrowthEventSchema:()=>ef,insertInsightShareSchema:()=>eh,insertIntegrationSchema:()=>ed,insertMessageLinkSchema:()=>eS,insertMessageSchema:()=>eB,insertOauthTokenSchema:()=>en,insertPersonSchema:()=>Q,insertReferralCodeSchema:()=>ec,insertReferralEdgeSchema:()=>eu,insertSuggestionSchema:()=>er,insertWorkspaceMemberSchema:()=>X,insertWorkspaceSchema:()=>F,insightShare:()=>U,integration:()=>C,message:()=>G,messageLink:()=>Y,notification:()=>h,oauthToken:()=>O,org:()=>K,person:()=>g,personEncounter:()=>A,referralCode:()=>T,referralEdge:()=>E,selectCollectiveOpportunitySchema:()=>eL,selectConversationSchema:()=>ej,selectCrmContactSyncSchema:()=>el,selectCrossWorkspaceOverlapSchema:()=>ev,selectEdgeSchema:()=>em,selectGoalSchema:()=>et,selectGraphInsightSchema:()=>ek,selectGraphMetricsSchema:()=>ey,selectGrowthEventSchema:()=>eI,selectInsightShareSchema:()=>eg,selectIntegrationSchema:()=>ea,selectMessageLinkSchema:()=>eb,selectMessageSchema:()=>eV,selectOauthTokenSchema:()=>ei,selectPersonSchema:()=>Z,selectReferralCodeSchema:()=>e_,selectReferralEdgeSchema:()=>ep,selectSuggestionSchema:()=>eo,selectWorkspaceMemberSchema:()=>H,selectWorkspaceSchema:()=>$,suggestion:()=>B,task:()=>S,workspace:()=>y,workspaceActivity:()=>k,workspaceMember:()=>N});var d=r(7428),a=r(84178),n=r(15074),i=r(12558),s=r(629),l=r(23297),c=r(73171),_=r(3132),u=r(76191),p=r(82594),f=r(33667),I=r(91697),w=r(47889),m=r(25507),x=r(6113);let encryptField=(e,t)=>{if(!e||!t)return e;try{let r=(0,x.randomBytes)(16),o=(0,x.createCipheriv)("aes-256-gcm",Buffer.from(t,"hex"),r),d=o.update(e,"utf8","hex");d+=o.final("hex");let a=o.getAuthTag();return`${r.toString("hex")}:${a.toString("hex")}:${d}`}catch(e){return console.error("Encryption failed:",e),null}},decryptField=(e,t)=>{if(!e||!t)return e;try{let r=e.split(":");if(3!==r.length)return Buffer.from(e,"base64").toString();let[o,d,a]=r,n=Buffer.from(o,"hex"),i=Buffer.from(d,"hex"),s=(0,x.createDecipheriv)("aes-256-gcm",Buffer.from(t,"hex"),n);s.setAuthTag(i);let l=s.update(a,"hex","utf8");return l+=s.final("utf8")}catch(e){return console.error("Decryption failed:",e),null}},y=(0,l.af)("workspace",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),name:(0,_.fL)("name").notNull(),ownerId:(0,_.fL)("owner_id").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({ownerIdx:(0,p.Kz)("workspace_owner_idx").on(e.ownerId)})),N=(0,l.af)("workspace_member",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),userId:(0,_.fL)("user_id").notNull(),slackUserId:(0,_.fL)("slack_user_id"),role:(0,_.fL)("role").notNull().default("member"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("workspace_member_workspace_idx").on(e.workspaceId),userIdx:(0,p.Kz)("workspace_member_user_idx").on(e.userId),slackUserIdx:(0,p.Kz)("workspace_member_slack_user_idx").on(e.slackUserId),uniqueMember:(0,p.Kz)("workspace_member_unique_idx").on(e.workspaceId,e.userId)})),k=(0,l.af)("workspace_activity",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),userId:(0,_.fL)("user_id").notNull(),action:(0,_.fL)("action").notNull(),entityType:(0,_.fL)("entity_type"),entityId:(0,c.Vj)("entity_id"),metadata:(0,f.JB)("metadata"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("workspace_activity_workspace_idx").on(e.workspaceId),userIdx:(0,p.Kz)("workspace_activity_user_idx").on(e.userId),createdIdx:(0,p.Kz)("workspace_activity_created_idx").on(e.createdAt)})),h=(0,l.af)("notification",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),userId:(0,_.fL)("user_id").notNull(),type:(0,_.fL)("type").notNull(),message:(0,_.fL)("message").notNull(),readAt:(0,u.AB)("read_at"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("notification_workspace_idx").on(e.workspaceId),userIdx:(0,p.Kz)("notification_user_idx").on(e.userId),readIdx:(0,p.Kz)("notification_read_idx").on(e.readAt)})),g=(0,l.af)("person",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),fullName:(0,_.fL)("full_name").notNull(),primaryEmail:(0,_.fL)("primary_email"),primaryPhone:(0,_.fL)("primary_phone"),location:(0,_.fL)("location"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("person_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("person_owner_idx").on(e.ownerId),emailIdx:(0,p.Kz)("person_email_idx").on(e.primaryEmail)})),K=(0,l.af)("org",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),name:(0,_.fL)("name").notNull(),domain:(0,_.fL)("domain"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({domainIdx:(0,p.Kz)("org_domain_idx").on(e.domain)})),v=(0,l.af)("encounter",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),kind:(0,_.fL)("kind").notNull(),occurredAt:(0,u.AB)("occurred_at").notNull(),summary:(0,_.fL)("summary"),raw:(0,f.JB)("raw"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("encounter_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("encounter_owner_idx").on(e.ownerId),occurredIdx:(0,p.Kz)("encounter_occurred_idx").on(e.occurredAt)})),A=(0,l.af)("person_encounter",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),personId:(0,c.Vj)("person_id").references(()=>g.id).notNull(),encounterId:(0,c.Vj)("encounter_id").references(()=>v.id).notNull(),role:(0,_.fL)("role").notNull()},e=>({personIdx:(0,p.Kz)("person_encounter_person_idx").on(e.personId),encounterIdx:(0,p.Kz)("person_encounter_encounter_idx").on(e.encounterId)})),L=(0,l.af)("edge",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),fromId:(0,c.Vj)("from_id").references(()=>g.id).notNull(),toId:(0,c.Vj)("to_id").references(()=>g.id).notNull(),type:(0,_.fL)("type").notNull(),strength:(0,I._L)("strength").notNull().default(1),metadata:(0,f.JB)("metadata"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("edge_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("edge_owner_idx").on(e.ownerId),fromIdx:(0,p.Kz)("edge_from_idx").on(e.fromId),toIdx:(0,p.Kz)("edge_to_idx").on(e.toId),typeIdx:(0,p.Kz)("edge_type_idx").on(e.type)})),z=(0,l.af)("claim",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),subjectType:(0,_.fL)("subject_type").notNull(),subjectId:(0,c.Vj)("subject_id").notNull(),key:(0,_.fL)("key").notNull(),value:(0,_.fL)("value").notNull(),confidence:(0,I._L)("confidence").notNull().default(50),source:(0,_.fL)("source").notNull(),lawfulBasis:(0,_.fL)("lawful_basis").notNull(),observedAt:(0,u.AB)("observed_at").defaultNow().notNull(),expiresAt:(0,u.AB)("expires_at"),provenance:(0,f.JB)("provenance")},e=>({workspaceIdx:(0,p.Kz)("claim_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("claim_owner_idx").on(e.ownerId),subjectIdx:(0,p.Kz)("claim_subject_idx").on(e.subjectType,e.subjectId),keyIdx:(0,p.Kz)("claim_key_idx").on(e.key)})),j=(0,l.af)("goal",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),kind:(0,_.fL)("kind").notNull(),title:(0,_.fL)("title").notNull(),details:(0,_.fL)("details"),status:(0,_.fL)("status").notNull().default("active"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("goal_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("goal_owner_idx").on(e.ownerId),kindIdx:(0,p.Kz)("goal_kind_idx").on(e.kind)})),B=(0,l.af)("suggestion",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),kind:(0,_.fL)("kind").notNull(),aId:(0,c.Vj)("a_id").references(()=>g.id).notNull(),bId:(0,c.Vj)("b_id").references(()=>g.id).notNull(),goalId:(0,c.Vj)("goal_id").references(()=>j.id),score:(0,I._L)("score").notNull(),why:(0,f.JB)("why"),draft:(0,f.JB)("draft"),state:(0,_.fL)("state").notNull().default("proposed"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("suggestion_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("suggestion_owner_idx").on(e.ownerId),goalIdx:(0,p.Kz)("suggestion_goal_idx").on(e.goalId),stateIdx:(0,p.Kz)("suggestion_state_idx").on(e.state)})),V=(0,l.af)("consent",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),subjectId:(0,c.Vj)("subject_id").references(()=>g.id).notNull(),scope:(0,_.fL)("scope").notNull(),grantedAt:(0,u.AB)("granted_at").defaultNow().notNull(),policyVersion:(0,_.fL)("policy_version").notNull()},e=>({workspaceIdx:(0,p.Kz)("consent_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("consent_owner_idx").on(e.ownerId),subjectIdx:(0,p.Kz)("consent_subject_idx").on(e.subjectId)})),S=(0,l.af)("task",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),title:(0,_.fL)("title").notNull(),dueAt:(0,u.AB)("due_at"),data:(0,f.JB)("data"),completed:(0,w.O7)("completed").notNull().default(!1)},e=>({workspaceIdx:(0,p.Kz)("task_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("task_owner_idx").on(e.ownerId),dueIdx:(0,p.Kz)("task_due_idx").on(e.dueAt)})),b=(0,l.af)("event_log",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),event:(0,_.fL)("event").notNull(),entityType:(0,_.fL)("entity_type"),entityId:(0,c.Vj)("entity_id"),metadata:(0,f.JB)("metadata"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("event_log_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("event_log_owner_idx").on(e.ownerId),eventIdx:(0,p.Kz)("event_log_event_idx").on(e.event)})),C=(0,l.af)("integration",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),provider:(0,_.fL)("provider").notNull(),status:(0,_.fL)("status").notNull().default("disconnected"),config:(0,f.JB)("config"),lastSyncAt:(0,u.AB)("last_sync_at"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("integration_workspace_idx").on(e.workspaceId),providerIdx:(0,p.Kz)("integration_provider_idx").on(e.provider),statusIdx:(0,p.Kz)("integration_status_idx").on(e.status)})),O=(0,l.af)("oauth_token",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),provider:(0,_.fL)("provider").notNull(),accessToken:(0,_.fL)("access_token").notNull(),refreshToken:(0,_.fL)("refresh_token"),expiresAt:(0,u.AB)("expires_at"),scope:(0,_.fL)("scope").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("oauth_token_workspace_idx").on(e.workspaceId),providerIdx:(0,p.Kz)("oauth_token_provider_idx").on(e.provider)})),R=(0,l.af)("crm_contact_sync",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),crmId:(0,_.fL)("crm_id").notNull(),rhizPersonId:(0,c.Vj)("rhiz_person_id").references(()=>g.id).notNull(),crmProvider:(0,_.fL)("crm_provider").notNull(),lastSyncedAt:(0,u.AB)("last_synced_at").defaultNow().notNull(),syncStatus:(0,_.fL)("sync_status").notNull().default("synced"),metadata:(0,f.JB)("metadata")},e=>({workspaceIdx:(0,p.Kz)("crm_contact_sync_workspace_idx").on(e.workspaceId),crmIdIdx:(0,p.Kz)("crm_contact_sync_crm_id_idx").on(e.crmId),personIdx:(0,p.Kz)("crm_contact_sync_person_idx").on(e.rhizPersonId),providerIdx:(0,p.Kz)("crm_contact_sync_provider_idx").on(e.crmProvider)})),T=(0,l.af)("referral_code",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),code:(0,_.fL)("code").notNull().unique(),creatorId:(0,_.fL)("creator_id").notNull(),maxUses:(0,I._L)("max_uses"),used:(0,I._L)("used").notNull().default(0),rewardType:(0,_.fL)("reward_type").notNull(),rewardValue:(0,I._L)("reward_value"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),expiresAt:(0,u.AB)("expires_at")},e=>({codeIdx:(0,p.Kz)("referral_code_code_idx").on(e.code),creatorIdx:(0,p.Kz)("referral_code_creator_idx").on(e.creatorId),usedIdx:(0,p.Kz)("referral_code_used_idx").on(e.used)})),E=(0,l.af)("referral_edge",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),inviterId:(0,_.fL)("inviter_id").notNull(),inviteeId:(0,_.fL)("invitee_id").notNull(),referralCodeId:(0,c.Vj)("referral_code_id").references(()=>T.id),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({inviterIdx:(0,p.Kz)("referral_edge_inviter_idx").on(e.inviterId),inviteeIdx:(0,p.Kz)("referral_edge_invitee_idx").on(e.inviteeId),codeIdx:(0,p.Kz)("referral_edge_code_idx").on(e.referralCodeId)})),P=(0,l.af)("growth_event",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),userId:(0,_.fL)("user_id").notNull(),type:(0,_.fL)("type").notNull(),meta:(0,f.JB)("meta"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({userIdx:(0,p.Kz)("growth_event_user_idx").on(e.userId),typeIdx:(0,p.Kz)("growth_event_type_idx").on(e.type),createdIdx:(0,p.Kz)("growth_event_created_idx").on(e.createdAt)})),J=(0,l.af)("graph_metrics",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),personId:(0,c.Vj)("person_id").references(()=>g.id).notNull(),metric:(0,_.fL)("metric").notNull(),value:(0,f.JB)("value").notNull(),calculatedAt:(0,u.AB)("calculated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("graph_metrics_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("graph_metrics_owner_idx").on(e.ownerId),personIdx:(0,p.Kz)("graph_metrics_person_idx").on(e.personId),metricIdx:(0,p.Kz)("graph_metrics_metric_idx").on(e.metric),uniqueMetric:(0,p.Kz)("graph_metrics_unique_idx").on(e.personId,e.metric)})),M=(0,l.af)("graph_insight",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),type:(0,_.fL)("type").notNull(),title:(0,_.fL)("title").notNull(),detail:(0,_.fL)("detail").notNull(),personId:(0,c.Vj)("person_id").references(()=>g.id),goalId:(0,c.Vj)("goal_id").references(()=>j.id),score:(0,I._L)("score").notNull().default(50),provenance:(0,f.JB)("provenance"),state:(0,_.fL)("state").notNull().default("active"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),expiresAt:(0,u.AB)("expires_at")},e=>({workspaceIdx:(0,p.Kz)("graph_insight_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("graph_insight_owner_idx").on(e.ownerId),typeIdx:(0,p.Kz)("graph_insight_type_idx").on(e.type),personIdx:(0,p.Kz)("graph_insight_person_idx").on(e.personId),goalIdx:(0,p.Kz)("graph_insight_goal_idx").on(e.goalId),stateIdx:(0,p.Kz)("graph_insight_state_idx").on(e.state)})),U=(0,l.af)("insight_share",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),insightId:(0,c.Vj)("insight_id").references(()=>M.id).notNull(),sharedBy:(0,_.fL)("shared_by").notNull(),sharedWith:(0,_.fL)("shared_with").notNull(),visibility:(0,_.fL)("visibility").notNull().default("workspace"),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({insightIdx:(0,p.Kz)("insight_share_insight_idx").on(e.insightId),sharedByIdx:(0,p.Kz)("insight_share_shared_by_idx").on(e.sharedBy),sharedWithIdx:(0,p.Kz)("insight_share_shared_with_idx").on(e.sharedWith),workspaceIdx:(0,p.Kz)("insight_share_workspace_idx").on(e.workspaceId),visibilityIdx:(0,p.Kz)("insight_share_visibility_idx").on(e.visibility)})),D=(0,l.af)("cross_workspace_overlap",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),personId:(0,c.Vj)("person_id").references(()=>g.id).notNull(),workspaces:(0,f.JB)("workspaces").notNull(),overlapType:(0,_.fL)("overlap_type").notNull(),confidence:(0,I._L)("confidence").notNull().default(80),detectedAt:(0,u.AB)("detected_at").defaultNow().notNull(),state:(0,_.fL)("state").notNull().default("active")},e=>({personIdx:(0,p.Kz)("cross_workspace_overlap_person_idx").on(e.personId),overlapTypeIdx:(0,p.Kz)("cross_workspace_overlap_type_idx").on(e.overlapType),stateIdx:(0,p.Kz)("cross_workspace_overlap_state_idx").on(e.state)})),W=(0,l.af)("collective_opportunity",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),title:(0,_.fL)("title").notNull(),description:(0,_.fL)("description").notNull(),type:(0,_.fL)("type").notNull(),workspaces:(0,f.JB)("workspaces").notNull(),clusters:(0,f.JB)("clusters").notNull(),score:(0,I._L)("score").notNull().default(50),status:(0,_.fL)("status").notNull().default("proposed"),createdBy:(0,_.fL)("created_by").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),expiresAt:(0,u.AB)("expires_at")},e=>({typeIdx:(0,p.Kz)("collective_opportunity_type_idx").on(e.type),statusIdx:(0,p.Kz)("collective_opportunity_status_idx").on(e.status),createdByIdx:(0,p.Kz)("collective_opportunity_created_by_idx").on(e.createdBy)})),q=(0,l.af)("conversation",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>y.id).notNull(),title:(0,_.fL)("title").notNull(),createdBy:(0,_.fL)("created_by").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("conversation_workspace_idx").on(e.workspaceId),createdByIdx:(0,p.Kz)("conversation_created_by_idx").on(e.createdBy),updatedIdx:(0,p.Kz)("conversation_updated_idx").on(e.updatedAt)})),G=(0,l.af)("message",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),conversationId:(0,c.Vj)("conversation_id").references(()=>q.id).notNull(),senderType:(0,_.fL)("sender_type").notNull(),senderId:(0,_.fL)("sender_id"),text:(0,_.fL)("text").notNull(),data:(0,f.JB)("data"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({conversationIdx:(0,p.Kz)("message_conversation_idx").on(e.conversationId),senderTypeIdx:(0,p.Kz)("message_sender_type_idx").on(e.senderType),createdIdx:(0,p.Kz)("message_created_idx").on(e.createdAt),conversationCreatedIdx:(0,p.Kz)("message_conversation_created_idx").on(e.conversationId,e.createdAt)})),Y=(0,l.af)("message_link",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),messageId:(0,c.Vj)("message_id").references(()=>G.id).notNull(),subjectType:(0,_.fL)("subject_type").notNull(),subjectId:(0,c.Vj)("subject_id").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({messageIdx:(0,p.Kz)("message_link_message_idx").on(e.messageId),subjectIdx:(0,p.Kz)("message_link_subject_idx").on(e.subjectType,e.subjectId)})),F=(0,m.fC)(y),$=(0,m.IO)(y),X=(0,m.fC)(N),H=(0,m.IO)(N),Q=(0,m.fC)(g),Z=(0,m.IO)(g),ee=(0,m.fC)(j),et=(0,m.IO)(j),er=(0,m.fC)(B),eo=(0,m.IO)(B),ed=(0,m.fC)(C),ea=(0,m.IO)(C),en=(0,m.fC)(O),ei=(0,m.IO)(O),es=(0,m.fC)(R),el=(0,m.IO)(R),ec=(0,m.fC)(T),e_=(0,m.IO)(T),eu=(0,m.fC)(E),ep=(0,m.IO)(E),ef=(0,m.fC)(P),eI=(0,m.IO)(P),ew=(0,m.fC)(L),em=(0,m.IO)(L),ex=(0,m.fC)(J),ey=(0,m.IO)(J),eN=(0,m.fC)(M),ek=(0,m.IO)(M),eh=(0,m.fC)(U),eg=(0,m.IO)(U),eK=(0,m.fC)(D),ev=(0,m.IO)(D),eA=(0,m.fC)(W),eL=(0,m.IO)(W),ez=(0,m.fC)(q),ej=(0,m.IO)(q),eB=(0,m.fC)(G),eV=(0,m.IO)(G),eS=(0,m.fC)(Y),eb=(0,m.IO)(Y),encryptPhone=e=>{let t=process.env.ENCRYPTION_KEY;return encryptField(e,t)},decryptPhone=e=>{let t=process.env.ENCRYPTION_KEY;return decryptField(e,t)},encryptOAuthToken=e=>{let t=process.env.ENCRYPTION_KEY;return encryptField(e,t)},decryptOAuthToken=e=>{let t=process.env.ENCRYPTION_KEY;return decryptField(e,t)},eC=process.env.DATABASE_POOL_URL||process.env.DATABASE_URL,eO=(0,a.Z)(eC,{max:parseInt(process.env.DB_POOL_MAX||"25"),idle_timeout:parseInt(process.env.DB_IDLE_TIMEOUT||"20"),max_lifetime:parseInt(process.env.DB_MAX_LIFETIME||"1800"),connect_timeout:10,ssl:{rejectUnauthorized:!1}}),eR=(0,d.t)(eO,{schema:o}),setUserContext=async e=>{await eO`SELECT set_config('app.current_user_id', ${e}, true)`}}};