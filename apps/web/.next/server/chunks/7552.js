"use strict";exports.id=7552,exports.ids=[7552],exports.modules={37552:(e,t,d)=>{d.d(t,{M0:()=>eO,xD:()=>n.xD,QS:()=>z,HM:()=>D,db:()=>eW,C8:()=>i.C,i$:()=>L,qU:()=>v,eq:()=>n.eq,hS:()=>j,t6:()=>k,lB:()=>h,oR:()=>A,v8:()=>setUserContext,pp:()=>eC,i6:()=>s.i6,Jz:()=>B});var r={};d.r(r),d.d(r,{agentEvents:()=>eO,claim:()=>z,collectiveOpportunity:()=>D,consent:()=>V,conversation:()=>W,crmContactSync:()=>R,crossWorkspaceOverlap:()=>q,decryptOAuthToken:()=>decryptOAuthToken,decryptPhone:()=>decryptPhone,edge:()=>L,encounter:()=>v,encryptOAuthToken:()=>encryptOAuthToken,encryptPhone:()=>encryptPhone,eventLog:()=>b,goal:()=>j,graphInsight:()=>M,graphMetrics:()=>P,growthEvent:()=>J,insertAgentEventsSchema:()=>eJ,insertCollectiveOpportunitySchema:()=>eA,insertConversationSchema:()=>ez,insertCrmContactSyncSchema:()=>es,insertCrossWorkspaceOverlapSchema:()=>eK,insertEdgeSchema:()=>em,insertGoalSchema:()=>ee,insertGraphInsightSchema:()=>ey,insertGraphMetricsSchema:()=>ew,insertGrowthEventSchema:()=>ef,insertInsightShareSchema:()=>ek,insertIntegrationSchema:()=>eo,insertMessageLinkSchema:()=>eS,insertMessageSchema:()=>eB,insertOauthTokenSchema:()=>en,insertPeopleEmbeddingSchema:()=>eM,insertPersonSchema:()=>Q,insertReferralCodeSchema:()=>ec,insertReferralEdgeSchema:()=>eu,insertSignalsSchema:()=>eT,insertSuggestionSchema:()=>ed,insertWorkspaceMemberSchema:()=>X,insertWorkspaceSchema:()=>F,insightShare:()=>U,integration:()=>C,message:()=>G,messageLink:()=>Y,notification:()=>k,oauthToken:()=>O,org:()=>K,peopleEmbedding:()=>eR,person:()=>h,personEncounter:()=>A,referralCode:()=>T,referralEdge:()=>E,selectAgentEventsSchema:()=>eP,selectCollectiveOpportunitySchema:()=>eL,selectConversationSchema:()=>ej,selectCrmContactSyncSchema:()=>el,selectCrossWorkspaceOverlapSchema:()=>ev,selectEdgeSchema:()=>ex,selectGoalSchema:()=>et,selectGraphInsightSchema:()=>eg,selectGraphMetricsSchema:()=>eN,selectGrowthEventSchema:()=>eI,selectInsightShareSchema:()=>eh,selectIntegrationSchema:()=>ea,selectMessageLinkSchema:()=>eb,selectMessageSchema:()=>eV,selectOauthTokenSchema:()=>ei,selectPeopleEmbeddingSchema:()=>eU,selectPersonSchema:()=>Z,selectReferralCodeSchema:()=>e_,selectReferralEdgeSchema:()=>ep,selectSignalsSchema:()=>eE,selectSuggestionSchema:()=>er,selectWorkspaceMemberSchema:()=>H,selectWorkspaceSchema:()=>$,signals:()=>eC,suggestion:()=>B,task:()=>S,workspace:()=>N,workspaceActivity:()=>g,workspaceMember:()=>y});var o=d(7428),a=d(84178),n=d(15074),i=d(12558),s=d(629),l=d(23297),c=d(73171),_=d(3132),u=d(76191),p=d(82594),f=d(33667),I=d(91697),m=d(47889),x=d(25507),w=d(6113);let encryptField=(e,t)=>{if(!e||!t)return e;try{let d=(0,w.randomBytes)(16),r=(0,w.createCipheriv)("aes-256-gcm",Buffer.from(t,"hex"),d),o=r.update(e,"utf8","hex");o+=r.final("hex");let a=r.getAuthTag();return`${d.toString("hex")}:${a.toString("hex")}:${o}`}catch(e){return console.error("Encryption failed:",e),null}},decryptField=(e,t)=>{if(!e||!t)return e;try{let d=e.split(":");if(3!==d.length)return Buffer.from(e,"base64").toString();let[r,o,a]=d,n=Buffer.from(r,"hex"),i=Buffer.from(o,"hex"),s=(0,w.createDecipheriv)("aes-256-gcm",Buffer.from(t,"hex"),n);s.setAuthTag(i);let l=s.update(a,"hex","utf8");return l+=s.final("utf8")}catch(e){return console.error("Decryption failed:",e),null}},N=(0,l.af)("workspace",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),name:(0,_.fL)("name").notNull(),ownerId:(0,_.fL)("owner_id").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({ownerIdx:(0,p.Kz)("workspace_owner_idx").on(e.ownerId)})),y=(0,l.af)("workspace_member",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),userId:(0,_.fL)("user_id").notNull(),slackUserId:(0,_.fL)("slack_user_id"),role:(0,_.fL)("role").notNull().default("member"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("workspace_member_workspace_idx").on(e.workspaceId),userIdx:(0,p.Kz)("workspace_member_user_idx").on(e.userId),slackUserIdx:(0,p.Kz)("workspace_member_slack_user_idx").on(e.slackUserId),uniqueMember:(0,p.Kz)("workspace_member_unique_idx").on(e.workspaceId,e.userId)})),g=(0,l.af)("workspace_activity",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),userId:(0,_.fL)("user_id").notNull(),action:(0,_.fL)("action").notNull(),entityType:(0,_.fL)("entity_type"),entityId:(0,c.Vj)("entity_id"),metadata:(0,f.JB)("metadata"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("workspace_activity_workspace_idx").on(e.workspaceId),userIdx:(0,p.Kz)("workspace_activity_user_idx").on(e.userId),createdIdx:(0,p.Kz)("workspace_activity_created_idx").on(e.createdAt)})),k=(0,l.af)("notification",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),userId:(0,_.fL)("user_id").notNull(),type:(0,_.fL)("type").notNull(),message:(0,_.fL)("message").notNull(),readAt:(0,u.AB)("read_at"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("notification_workspace_idx").on(e.workspaceId),userIdx:(0,p.Kz)("notification_user_idx").on(e.userId),readIdx:(0,p.Kz)("notification_read_idx").on(e.readAt)})),h=(0,l.af)("person",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),fullName:(0,_.fL)("full_name").notNull(),primaryEmail:(0,_.fL)("primary_email"),primaryPhone:(0,_.fL)("primary_phone"),location:(0,_.fL)("location"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("person_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("person_owner_idx").on(e.ownerId),emailIdx:(0,p.Kz)("person_email_idx").on(e.primaryEmail)})),K=(0,l.af)("org",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),name:(0,_.fL)("name").notNull(),domain:(0,_.fL)("domain"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({domainIdx:(0,p.Kz)("org_domain_idx").on(e.domain)})),v=(0,l.af)("encounter",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),kind:(0,_.fL)("kind").notNull(),occurredAt:(0,u.AB)("occurred_at").notNull(),summary:(0,_.fL)("summary"),raw:(0,f.JB)("raw"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("encounter_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("encounter_owner_idx").on(e.ownerId),occurredIdx:(0,p.Kz)("encounter_occurred_idx").on(e.occurredAt)})),A=(0,l.af)("person_encounter",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),personId:(0,c.Vj)("person_id").references(()=>h.id).notNull(),encounterId:(0,c.Vj)("encounter_id").references(()=>v.id).notNull(),role:(0,_.fL)("role").notNull()},e=>({personIdx:(0,p.Kz)("person_encounter_person_idx").on(e.personId),encounterIdx:(0,p.Kz)("person_encounter_encounter_idx").on(e.encounterId)})),L=(0,l.af)("edge",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),fromId:(0,c.Vj)("from_id").references(()=>h.id).notNull(),toId:(0,c.Vj)("to_id").references(()=>h.id).notNull(),type:(0,_.fL)("type").notNull(),strength:(0,I._L)("strength").notNull().default(1),metadata:(0,f.JB)("metadata"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("edge_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("edge_owner_idx").on(e.ownerId),fromIdx:(0,p.Kz)("edge_from_idx").on(e.fromId),toIdx:(0,p.Kz)("edge_to_idx").on(e.toId),typeIdx:(0,p.Kz)("edge_type_idx").on(e.type)})),z=(0,l.af)("claim",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),subjectType:(0,_.fL)("subject_type").notNull(),subjectId:(0,c.Vj)("subject_id").notNull(),key:(0,_.fL)("key").notNull(),value:(0,_.fL)("value").notNull(),confidence:(0,I._L)("confidence").notNull().default(50),source:(0,_.fL)("source").notNull(),lawfulBasis:(0,_.fL)("lawful_basis").notNull(),observedAt:(0,u.AB)("observed_at").defaultNow().notNull(),expiresAt:(0,u.AB)("expires_at"),provenance:(0,f.JB)("provenance")},e=>({workspaceIdx:(0,p.Kz)("claim_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("claim_owner_idx").on(e.ownerId),subjectIdx:(0,p.Kz)("claim_subject_idx").on(e.subjectType,e.subjectId),keyIdx:(0,p.Kz)("claim_key_idx").on(e.key)})),j=(0,l.af)("goal",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),kind:(0,_.fL)("kind").notNull(),title:(0,_.fL)("title").notNull(),details:(0,_.fL)("details"),status:(0,_.fL)("status").notNull().default("active"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("goal_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("goal_owner_idx").on(e.ownerId),kindIdx:(0,p.Kz)("goal_kind_idx").on(e.kind)})),B=(0,l.af)("suggestion",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),kind:(0,_.fL)("kind").notNull(),aId:(0,c.Vj)("a_id").references(()=>h.id).notNull(),bId:(0,c.Vj)("b_id").references(()=>h.id).notNull(),goalId:(0,c.Vj)("goal_id").references(()=>j.id),score:(0,I._L)("score").notNull(),why:(0,f.JB)("why"),draft:(0,f.JB)("draft"),state:(0,_.fL)("state").notNull().default("proposed"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("suggestion_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("suggestion_owner_idx").on(e.ownerId),goalIdx:(0,p.Kz)("suggestion_goal_idx").on(e.goalId),stateIdx:(0,p.Kz)("suggestion_state_idx").on(e.state)})),V=(0,l.af)("consent",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),subjectId:(0,c.Vj)("subject_id").references(()=>h.id).notNull(),scope:(0,_.fL)("scope").notNull(),grantedAt:(0,u.AB)("granted_at").defaultNow().notNull(),policyVersion:(0,_.fL)("policy_version").notNull()},e=>({workspaceIdx:(0,p.Kz)("consent_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("consent_owner_idx").on(e.ownerId),subjectIdx:(0,p.Kz)("consent_subject_idx").on(e.subjectId)})),S=(0,l.af)("task",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),title:(0,_.fL)("title").notNull(),dueAt:(0,u.AB)("due_at"),data:(0,f.JB)("data"),completed:(0,m.O7)("completed").notNull().default(!1)},e=>({workspaceIdx:(0,p.Kz)("task_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("task_owner_idx").on(e.ownerId),dueIdx:(0,p.Kz)("task_due_idx").on(e.dueAt)})),b=(0,l.af)("event_log",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),event:(0,_.fL)("event").notNull(),entityType:(0,_.fL)("entity_type"),entityId:(0,c.Vj)("entity_id"),metadata:(0,f.JB)("metadata"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("event_log_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("event_log_owner_idx").on(e.ownerId),eventIdx:(0,p.Kz)("event_log_event_idx").on(e.event)})),C=(0,l.af)("integration",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),provider:(0,_.fL)("provider").notNull(),status:(0,_.fL)("status").notNull().default("disconnected"),config:(0,f.JB)("config"),lastSyncAt:(0,u.AB)("last_sync_at"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("integration_workspace_idx").on(e.workspaceId),providerIdx:(0,p.Kz)("integration_provider_idx").on(e.provider),statusIdx:(0,p.Kz)("integration_status_idx").on(e.status)})),O=(0,l.af)("oauth_token",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),provider:(0,_.fL)("provider").notNull(),accessToken:(0,_.fL)("access_token").notNull(),refreshToken:(0,_.fL)("refresh_token"),expiresAt:(0,u.AB)("expires_at"),scope:(0,_.fL)("scope").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("oauth_token_workspace_idx").on(e.workspaceId),providerIdx:(0,p.Kz)("oauth_token_provider_idx").on(e.provider)})),R=(0,l.af)("crm_contact_sync",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),crmId:(0,_.fL)("crm_id").notNull(),rhizPersonId:(0,c.Vj)("rhiz_person_id").references(()=>h.id).notNull(),crmProvider:(0,_.fL)("crm_provider").notNull(),lastSyncedAt:(0,u.AB)("last_synced_at").defaultNow().notNull(),syncStatus:(0,_.fL)("sync_status").notNull().default("synced"),metadata:(0,f.JB)("metadata")},e=>({workspaceIdx:(0,p.Kz)("crm_contact_sync_workspace_idx").on(e.workspaceId),crmIdIdx:(0,p.Kz)("crm_contact_sync_crm_id_idx").on(e.crmId),personIdx:(0,p.Kz)("crm_contact_sync_person_idx").on(e.rhizPersonId),providerIdx:(0,p.Kz)("crm_contact_sync_provider_idx").on(e.crmProvider)})),T=(0,l.af)("referral_code",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),code:(0,_.fL)("code").notNull().unique(),creatorId:(0,_.fL)("creator_id").notNull(),maxUses:(0,I._L)("max_uses"),used:(0,I._L)("used").notNull().default(0),rewardType:(0,_.fL)("reward_type").notNull(),rewardValue:(0,I._L)("reward_value"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),expiresAt:(0,u.AB)("expires_at")},e=>({codeIdx:(0,p.Kz)("referral_code_code_idx").on(e.code),creatorIdx:(0,p.Kz)("referral_code_creator_idx").on(e.creatorId),usedIdx:(0,p.Kz)("referral_code_used_idx").on(e.used)})),E=(0,l.af)("referral_edge",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),inviterId:(0,_.fL)("inviter_id").notNull(),inviteeId:(0,_.fL)("invitee_id").notNull(),referralCodeId:(0,c.Vj)("referral_code_id").references(()=>T.id),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({inviterIdx:(0,p.Kz)("referral_edge_inviter_idx").on(e.inviterId),inviteeIdx:(0,p.Kz)("referral_edge_invitee_idx").on(e.inviteeId),codeIdx:(0,p.Kz)("referral_edge_code_idx").on(e.referralCodeId)})),J=(0,l.af)("growth_event",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),userId:(0,_.fL)("user_id").notNull(),type:(0,_.fL)("type").notNull(),meta:(0,f.JB)("meta"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({userIdx:(0,p.Kz)("growth_event_user_idx").on(e.userId),typeIdx:(0,p.Kz)("growth_event_type_idx").on(e.type),createdIdx:(0,p.Kz)("growth_event_created_idx").on(e.createdAt)})),P=(0,l.af)("graph_metrics",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),personId:(0,c.Vj)("person_id").references(()=>h.id).notNull(),metric:(0,_.fL)("metric").notNull(),value:(0,f.JB)("value").notNull(),calculatedAt:(0,u.AB)("calculated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("graph_metrics_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("graph_metrics_owner_idx").on(e.ownerId),personIdx:(0,p.Kz)("graph_metrics_person_idx").on(e.personId),metricIdx:(0,p.Kz)("graph_metrics_metric_idx").on(e.metric),uniqueMetric:(0,p.Kz)("graph_metrics_unique_idx").on(e.personId,e.metric)})),M=(0,l.af)("graph_insight",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),ownerId:(0,_.fL)("owner_id").notNull(),type:(0,_.fL)("type").notNull(),title:(0,_.fL)("title").notNull(),detail:(0,_.fL)("detail").notNull(),personId:(0,c.Vj)("person_id").references(()=>h.id),goalId:(0,c.Vj)("goal_id").references(()=>j.id),score:(0,I._L)("score").notNull().default(50),provenance:(0,f.JB)("provenance"),state:(0,_.fL)("state").notNull().default("active"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),expiresAt:(0,u.AB)("expires_at")},e=>({workspaceIdx:(0,p.Kz)("graph_insight_workspace_idx").on(e.workspaceId),ownerIdx:(0,p.Kz)("graph_insight_owner_idx").on(e.ownerId),typeIdx:(0,p.Kz)("graph_insight_type_idx").on(e.type),personIdx:(0,p.Kz)("graph_insight_person_idx").on(e.personId),goalIdx:(0,p.Kz)("graph_insight_goal_idx").on(e.goalId),stateIdx:(0,p.Kz)("graph_insight_state_idx").on(e.state)})),U=(0,l.af)("insight_share",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),insightId:(0,c.Vj)("insight_id").references(()=>M.id).notNull(),sharedBy:(0,_.fL)("shared_by").notNull(),sharedWith:(0,_.fL)("shared_with").notNull(),visibility:(0,_.fL)("visibility").notNull().default("workspace"),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({insightIdx:(0,p.Kz)("insight_share_insight_idx").on(e.insightId),sharedByIdx:(0,p.Kz)("insight_share_shared_by_idx").on(e.sharedBy),sharedWithIdx:(0,p.Kz)("insight_share_shared_with_idx").on(e.sharedWith),workspaceIdx:(0,p.Kz)("insight_share_workspace_idx").on(e.workspaceId),visibilityIdx:(0,p.Kz)("insight_share_visibility_idx").on(e.visibility)})),q=(0,l.af)("cross_workspace_overlap",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),personId:(0,c.Vj)("person_id").references(()=>h.id).notNull(),workspaces:(0,f.JB)("workspaces").notNull(),overlapType:(0,_.fL)("overlap_type").notNull(),confidence:(0,I._L)("confidence").notNull().default(80),detectedAt:(0,u.AB)("detected_at").defaultNow().notNull(),state:(0,_.fL)("state").notNull().default("active")},e=>({personIdx:(0,p.Kz)("cross_workspace_overlap_person_idx").on(e.personId),overlapTypeIdx:(0,p.Kz)("cross_workspace_overlap_type_idx").on(e.overlapType),stateIdx:(0,p.Kz)("cross_workspace_overlap_state_idx").on(e.state)})),D=(0,l.af)("collective_opportunity",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),title:(0,_.fL)("title").notNull(),description:(0,_.fL)("description").notNull(),type:(0,_.fL)("type").notNull(),workspaces:(0,f.JB)("workspaces").notNull(),clusters:(0,f.JB)("clusters").notNull(),score:(0,I._L)("score").notNull().default(50),status:(0,_.fL)("status").notNull().default("proposed"),createdBy:(0,_.fL)("created_by").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),expiresAt:(0,u.AB)("expires_at")},e=>({typeIdx:(0,p.Kz)("collective_opportunity_type_idx").on(e.type),statusIdx:(0,p.Kz)("collective_opportunity_status_idx").on(e.status),createdByIdx:(0,p.Kz)("collective_opportunity_created_by_idx").on(e.createdBy)})),W=(0,l.af)("conversation",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),workspaceId:(0,c.Vj)("workspace_id").references(()=>N.id).notNull(),title:(0,_.fL)("title").notNull(),createdBy:(0,_.fL)("created_by").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({workspaceIdx:(0,p.Kz)("conversation_workspace_idx").on(e.workspaceId),createdByIdx:(0,p.Kz)("conversation_created_by_idx").on(e.createdBy),updatedIdx:(0,p.Kz)("conversation_updated_idx").on(e.updatedAt)})),G=(0,l.af)("message",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),conversationId:(0,c.Vj)("conversation_id").references(()=>W.id).notNull(),senderType:(0,_.fL)("sender_type").notNull(),senderId:(0,_.fL)("sender_id"),text:(0,_.fL)("text").notNull(),data:(0,f.JB)("data"),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({conversationIdx:(0,p.Kz)("message_conversation_idx").on(e.conversationId),senderTypeIdx:(0,p.Kz)("message_sender_type_idx").on(e.senderType),createdIdx:(0,p.Kz)("message_created_idx").on(e.createdAt),conversationCreatedIdx:(0,p.Kz)("message_conversation_created_idx").on(e.conversationId,e.createdAt)})),Y=(0,l.af)("message_link",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),messageId:(0,c.Vj)("message_id").references(()=>G.id).notNull(),subjectType:(0,_.fL)("subject_type").notNull(),subjectId:(0,c.Vj)("subject_id").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({messageIdx:(0,p.Kz)("message_link_message_idx").on(e.messageId),subjectIdx:(0,p.Kz)("message_link_subject_idx").on(e.subjectType,e.subjectId)})),F=(0,x.fC)(N),$=(0,x.IO)(N),X=(0,x.fC)(y),H=(0,x.IO)(y),Q=(0,x.fC)(h),Z=(0,x.IO)(h),ee=(0,x.fC)(j),et=(0,x.IO)(j),ed=(0,x.fC)(B),er=(0,x.IO)(B),eo=(0,x.fC)(C),ea=(0,x.IO)(C),en=(0,x.fC)(O),ei=(0,x.IO)(O),es=(0,x.fC)(R),el=(0,x.IO)(R),ec=(0,x.fC)(T),e_=(0,x.IO)(T),eu=(0,x.fC)(E),ep=(0,x.IO)(E),ef=(0,x.fC)(J),eI=(0,x.IO)(J),em=(0,x.fC)(L),ex=(0,x.IO)(L),ew=(0,x.fC)(P),eN=(0,x.IO)(P),ey=(0,x.fC)(M),eg=(0,x.IO)(M),ek=(0,x.fC)(U),eh=(0,x.IO)(U),eK=(0,x.fC)(q),ev=(0,x.IO)(q),eA=(0,x.fC)(D),eL=(0,x.IO)(D),ez=(0,x.fC)(W),ej=(0,x.IO)(W),eB=(0,x.fC)(G),eV=(0,x.IO)(G),eS=(0,x.fC)(Y),eb=(0,x.IO)(Y),eC=(0,l.af)("signals",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),userId:(0,_.fL)("user_id").notNull(),contactId:(0,c.Vj)("contact_id").references(()=>h.id).notNull(),lastInteractionAt:(0,u.AB)("last_interaction_at"),interactions90d:(0,I._L)("interactions_90d").notNull().default(0),reciprocityRatio:(0,I._L)("reciprocity_ratio").notNull().default(0),sentimentAvg:(0,I._L)("sentiment_avg").notNull().default(0),decayDays:(0,I._L)("decay_days").notNull().default(0),roleTags:(0,f.JB)("role_tags").notNull().default("[]"),sharedContextTags:(0,f.JB)("shared_context_tags").notNull().default("[]"),goalAlignmentScore:(0,I._L)("goal_alignment_score").notNull().default(0),capacityCost:(0,I._L)("capacity_cost").notNull().default(100),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({userIdx:(0,p.Kz)("signals_user_idx").on(e.userId),contactIdx:(0,p.Kz)("signals_contact_idx").on(e.contactId),uniqueUserContact:(0,p.Kz)("signals_user_contact_unique_idx").on(e.userId,e.contactId),updatedIdx:(0,p.Kz)("signals_updated_idx").on(e.updatedAt)})),eO=(0,l.af)("agent_events",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),userId:(0,_.fL)("user_id").notNull(),goalId:(0,c.Vj)("goal_id").references(()=>j.id),agent:(0,_.fL)("agent").notNull(),action:(0,_.fL)("action").notNull(),payload:(0,f.JB)("payload").notNull(),createdAt:(0,u.AB)("created_at").defaultNow().notNull()},e=>({userIdx:(0,p.Kz)("agent_events_user_idx").on(e.userId),goalIdx:(0,p.Kz)("agent_events_goal_idx").on(e.goalId),agentIdx:(0,p.Kz)("agent_events_agent_idx").on(e.agent),actionIdx:(0,p.Kz)("agent_events_action_idx").on(e.action),createdIdx:(0,p.Kz)("agent_events_created_idx").on(e.createdAt)})),eR=(0,l.af)("people_embedding",{id:(0,c.Vj)("id").primaryKey().defaultRandom(),contactId:(0,c.Vj)("contact_id").references(()=>h.id).notNull().unique(),embedding:(0,f.JB)("embedding").notNull(),model:(0,_.fL)("model").notNull().default("text-embedding-3-small"),createdAt:(0,u.AB)("created_at").defaultNow().notNull(),updatedAt:(0,u.AB)("updated_at").defaultNow().notNull()},e=>({contactIdx:(0,p.Kz)("people_embedding_contact_idx").on(e.contactId),modelIdx:(0,p.Kz)("people_embedding_model_idx").on(e.model)})),eT=(0,x.fC)(eC),eE=(0,x.IO)(eC),eJ=(0,x.fC)(eO),eP=(0,x.IO)(eO),eM=(0,x.fC)(eR),eU=(0,x.IO)(eR),encryptPhone=e=>{let t=process.env.ENCRYPTION_KEY;return encryptField(e,t)},decryptPhone=e=>{let t=process.env.ENCRYPTION_KEY;return decryptField(e,t)},encryptOAuthToken=e=>{let t=process.env.ENCRYPTION_KEY;return encryptField(e,t)},decryptOAuthToken=e=>{let t=process.env.ENCRYPTION_KEY;return decryptField(e,t)},eq=process.env.DATABASE_POOL_URL||process.env.DATABASE_URL,eD=(0,a.Z)(eq,{max:parseInt(process.env.DB_POOL_MAX||"25"),idle_timeout:parseInt(process.env.DB_IDLE_TIMEOUT||"20"),max_lifetime:parseInt(process.env.DB_MAX_LIFETIME||"1800"),connect_timeout:10,ssl:{rejectUnauthorized:!1}}),eW=(0,o.t)(eD,{schema:r}),setUserContext=async e=>{await eD`SELECT set_config('app.current_user_id', ${e}, true)`}}};